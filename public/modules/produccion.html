<!-- Secci√≥n Producci√≥n - √ìrdenes y Lotes -->
<section id="produccion" class="section" style="display:none;">
  <h2>üè≠ Gesti√≥n de Producci√≥n</h2>
  
  <!-- Tabs de producci√≥n -->
  <div class="tabs">
    <button class="tab-button active" onclick="cambiarTab('ordenes')">üìã √ìrdenes</button>
    <button class="tab-button" onclick="cambiarTab('lotes')">üì¶ Lotes</button>
    <button class="tab-button" onclick="cambiarTab('consumos')">üìä Consumos</button>
    <button class="tab-button" onclick="cambiarTab('estadisticas')">üìà Estad√≠sticas</button>
  </div>

  <!-- Tab: √ìrdenes de Producci√≥n -->
  <div id="tab-ordenes" class="tab-content">
    <div class="toolbar">
      <button class="btn btn-primary" onclick="abrirModalNuevaOrdenProduccion()">‚ûï Nueva Orden</button>
      <button class="btn btn-secondary" onclick="cargarOrdenesProduccion()">üîÑ Actualizar</button>
      <div class="filter-group">
        <select id="filtroEstadoOrdenes" onchange="filtrarOrdenesProduccion()">
          <option value="">Todos los estados</option>
          <option value="PENDIENTE">Pendiente</option>
          <option value="EN_PROCESO">En Proceso</option>
          <option value="PAUSADA">Pausada</option>
          <option value="COMPLETADA">Completada</option>
          <option value="CANCELADA">Cancelada</option>
        </select>
      </div>
    </div>

    <div id="ordenesTableContainer" class="table-container">
      <table>
        <thead>
          <tr>
            <th>C√≥digo</th>
            <th>Plato</th>
            <th>Cantidad</th>
            <th>Fecha</th>
            <th>Estado</th>
            <th>Prioridad</th>
            <th>Responsable</th>
            <th>Rendimiento</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="ordenesTableBody">
          <tr><td colspan="9" style="text-align: center; padding: 30px;">‚è≥ Cargando √≥rdenes...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Tab: Lotes -->
  <div id="tab-lotes" class="tab-content">
    <div class="toolbar">
      <button class="btn btn-primary" onclick="abrirModalNuevoLote()">‚ûï Nuevo Lote</button>
      <button class="btn btn-secondary" onclick="cargarLotesProduccion()">üîÑ Actualizar</button>
      <div class="filter-group">
        <select id="filtroEstadoLotes" onchange="filtrarLotesProduccion()">
          <option value="">Todos los estados</option>
          <option value="ACTIVO">Activo</option>
          <option value="INACTIVO">Inactivo</option>
        </select>
      </div>
    </div>

    <div id="lotesTableContainer" class="table-container">
      <table>
        <thead>
          <tr>
            <th>C√≥digo Lote</th>
            <th>Orden</th>
            <th>Cantidad</th>
            <th>Fecha Producci√≥n</th>
            <th>Caducidad</th>
            <th>Estado</th>
            <th>Ubicaci√≥n</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="lotesTableBody">
          <tr><td colspan="8" style="text-align: center; padding: 30px;">‚è≥ Cargando lotes...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Tab: Consumos -->
  <div id="tab-consumos" class="tab-content">
    <div class="toolbar">
      <button class="btn btn-primary" onclick="abrirModalNuevoConsumo()">‚ûï Registrar Consumo</button>
      <button class="btn btn-secondary" onclick="cargarConsumosProduccion()">üîÑ Actualizar</button>
      <div class="filter-group">
        <input type="number" id="filtroOrdenIdConsumos" placeholder="Filtrar por orden ID" onchange="filtrarConsumosProduccion()" style="width: 150px;">
      </div>
    </div>

    <div id="consumosTableContainer" class="table-container">
      <table>
        <thead>
          <tr>
            <th>Orden</th>
            <th>Ingrediente</th>
            <th>Planificado</th>
            <th>Consumido</th>
            <th>Unidad</th>
            <th>Coste</th>
            <th>Usuario</th>
            <th>Fecha</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="consumosTableBody">
          <tr><td colspan="9" style="text-align: center; padding: 30px;">‚è≥ Cargando consumos...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Tab: Estad√≠sticas -->
  <div id="tab-estadisticas" class="tab-content">
    <div class="toolbar">
      <input type="date" id="filtroFechaDesdeStats" placeholder="Desde" onchange="cargarEstadisticasProduccion()">
      <input type="date" id="filtroFechaHastaStats" placeholder="Hasta" onchange="cargarEstadisticasProduccion()">
      <button class="btn btn-secondary" onclick="cargarEstadisticasProduccion()">üîÑ Actualizar</button>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Total √ìrdenes</div>
        <div class="stat-value" id="statTotalOrdenes">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Completadas</div>
        <div class="stat-value" id="statOrdenesCompletadas">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">En Proceso</div>
        <div class="stat-value" id="statOrdenesEnProceso">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Canceladas</div>
        <div class="stat-value" id="statOrdenesCanceladas">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Rendimiento Prom.</div>
        <div class="stat-value" id="statRendimiento">0%</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Coste Total</div>
        <div class="stat-value" id="statCosteTotal">$0</div>
      </div>
    </div>

    <div style="margin-top: 20px;">
      <h3>Rendimientos por Plato</h3>
      <div id="rendimientosTableContainer" class="table-container">
        <table>
          <thead>
            <tr>
              <th>Plato</th>
              <th>Total √ìrdenes</th>
              <th>Completadas</th>
              <th>Rendimiento Prom.</th>
              <th>Min - Max</th>
            </tr>
          </thead>
          <tbody id="rendimientosTableBody">
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modales -->
  <div id="modalNuevaOrdenProduccion" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>‚ûï Nueva Orden de Producci√≥n</h3>
        <button class="modal-close" onclick="cerrarModalProduccion('modalNuevaOrdenProduccion')">&times;</button>
      </div>
      <form onsubmit="crearOrdenProduccion(event)">
        <div class="form-group">
          <label>Plato *</label>
          <select id="platoSelectProduccion" required></select>
        </div>
        <div class="form-group">
          <label>Cantidad Planificada *</label>
          <input type="number" id="cantidadPlanificada" placeholder="Cantidad" min="1" step="0.01" required>
        </div>
        <div class="form-group">
          <label>Fecha Planificada *</label>
          <input type="date" id="fechaPlanificada" required>
        </div>
        <div class="form-group">
          <label>Prioridad</label>
          <select id="prioridadOrden">
            <option value="NORMAL">Normal</option>
            <option value="BAJA">Baja</option>
            <option value="ALTA">Alta</option>
            <option value="URGENTE">Urgente</option>
          </select>
        </div>
        <div class="form-group">
          <label>Responsable</label>
          <input type="text" id="responsableOrden" placeholder="Nombre del responsable">
        </div>
        <div class="form-group">
          <label>Observaciones</label>
          <textarea id="observacionesOrden" placeholder="Observaciones adicionales"></textarea>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Crear Orden</button>
          <button type="button" class="btn btn-secondary" onclick="cerrarModalProduccion('modalNuevaOrdenProduccion')">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <div id="modalNuevoLote" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>üì¶ Nuevo Lote</h3>
        <button class="modal-close" onclick="cerrarModalProduccion('modalNuevoLote')">&times;</button>
      </div>
      <form onsubmit="crearLoteProduccion(event)">
        <div class="form-group">
          <label>Orden *</label>
          <select id="ordenSelectLote" required></select>
        </div>
        <div class="form-group">
          <label>Cantidad *</label>
          <input type="number" id="cantidadLote" placeholder="Cantidad" min="1" step="0.01" required>
        </div>
        <div class="form-group">
          <label>Fecha Producci√≥n *</label>
          <input type="datetime-local" id="fechaProduccionLote" required>
        </div>
        <div class="form-group">
          <label>Fecha Caducidad</label>
          <input type="date" id="fechaCaducidadLote">
        </div>
        <div class="form-group">
          <label>Ubicaci√≥n</label>
          <input type="text" id="ubicacionLote" placeholder="Ubicaci√≥n de almacenamiento">
        </div>
        <div class="form-group">
          <label>Observaciones</label>
          <textarea id="observacionesLote" placeholder="Observaciones del lote"></textarea>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Crear Lote</button>
          <button type="button" class="btn btn-secondary" onclick="cerrarModalProduccion('modalNuevoLote')">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <div id="modalNuevoConsumo" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>üìä Registrar Consumo</h3>
        <button class="modal-close" onclick="cerrarModalProduccion('modalNuevoConsumo')">&times;</button>
      </div>
      <form onsubmit="crearConsumoProduccion(event)">
        <div class="form-group">
          <label>Orden *</label>
          <select id="ordenSelectConsumo" required></select>
        </div>
        <div class="form-group">
          <label>Ingrediente *</label>
          <select id="ingredienteSelectConsumo" required></select>
        </div>
        <div class="form-group">
          <label>Cantidad Planificada *</label>
          <input type="number" id="cantidadPlanificadaConsumo" placeholder="Cantidad" min="1" step="0.01" required>
        </div>
        <div class="form-group">
          <label>Cantidad Consumida</label>
          <input type="number" id="cantidadConsumidaConsumo" placeholder="Cantidad real consumida" step="0.01">
        </div>
        <div class="form-group">
          <label>Coste Unitario</label>
          <input type="number" id="costeConsumo" placeholder="Coste unitario" step="0.01">
        </div>
        <div class="form-group">
          <label>Observaciones</label>
          <textarea id="observacionesConsumo" placeholder="Observaciones del consumo"></textarea>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Registrar Consumo</button>
          <button type="button" class="btn btn-secondary" onclick="cerrarModalProduccion('modalNuevoConsumo')">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</section>
